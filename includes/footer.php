<?php
?>
</main>

<footer class="admin-footer">
  <div class="footer-inner" style="max-width:1200px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:20px">
    <div style="display:flex;align-items:center;gap:12px">
        <img src="assets/img/Avt-Vy.jpg" alt="Avatar" class="footer-avatar" style="width:40px;height:40px;border-radius:50%;border:2px solid var(--primary);box-shadow:var(--shadow)"/>
        <div style="display:flex;flex-direction:column">
            <span style="font-weight:600;font-size:14px;color:var(--dark)">© 2025 Admin Panel</span>
            <span style="font-size:12px;color:var(--muted)">Phát triển bởi Kỳ Vỹ DEV</span>
        </div>
    </div>
    
    <div style="display:flex;align-items:center;gap:20px">
        <a href="#" style="color:var(--muted);font-size:13px;text-decoration:none;display:flex;align-items:center;gap:6px;transition:color 0.3s">
            <svg style="width:16px;height:16px" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
            Điều khoản
        </a>
        <a href="#" style="color:var(--muted);font-size:13px;text-decoration:none;display:flex;align-items:center;gap:6px;transition:color 0.3s">
            <svg style="width:16px;height:16px" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/>
            </svg>
            Bảo mật
        </a>
        <a href="#" style="color:var(--muted);font-size:13px;text-decoration:none;display:flex;align-items:center;gap:6px;transition:color 0.3s">
            <svg style="width:16px;height:16px" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
            </svg>
            Liên hệ
        </a>
    </div>
    
    <div style="display:flex;align-items:center;gap:10px">
        <a href="#" style="width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--primary),var(--secondary));display:flex;align-items:center;justify-content:center;transition:transform 0.3s;box-shadow:var(--shadow-sm)" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
            <svg style="width:16px;height:16px" viewBox="0 0 24 24" fill="white">
                <path d="M22.46 6c-.85.38-1.78.64-2.75.76 1-.6 1.76-1.55 2.12-2.68-.93.55-1.96.96-3.06 1.18-.88-.94-2.13-1.53-3.51-1.53-2.66 0-4.81 2.16-4.81 4.81 0 .38.04.75.13 1.1-4-.2-7.54-2.12-9.91-5.04-.42.72-.66 1.55-.66 2.44 0 1.67.85 3.14 2.14 4-.79-.03-1.53-.24-2.18-.6v.06c0 2.33 1.66 4.28 3.86 4.72-.4.11-.83.17-1.27.17-.31 0-.62-.03-.92-.08.62 1.94 2.42 3.35 4.55 3.39-1.67 1.31-3.77 2.09-6.05 2.09-.39 0-.78-.02-1.17-.07 2.18 1.4 4.77 2.21 7.55 2.21 9.06 0 14.01-7.5 14.01-14.01 0-.21 0-.42-.02-.63.96-.7 1.8-1.56 2.46-2.55z"/>
            </svg>
        </a>
        <a href="#" style="width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;transition:transform 0.3s;box-shadow:var(--shadow-sm)" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
            <svg style="width:16px;height:16px" viewBox="0 0 24 24" fill="white">
                <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
            </svg>
        </a>
        <a href="#" style="width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,#f56565,#ed8936);display:flex;align-items:center;justify-content:center;transition:transform 0.3s;box-shadow:var(--shadow-sm)" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
            <svg style="width:16px;height:16px" viewBox="0 0 24 24" fill="white">
                <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295-.002 0-.003 0-.005 0l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.658-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z"/>
            </svg>
        </a>
    </div>
  </div>
</footer>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- Main JavaScript -->
<script src="assets/js/main.js"></script>

<script>
    (function () {
        const btn = document.getElementById('sidebar-toggle');
        const body = document.body;

        try {
            const saved = localStorage.getItem('sidebar-collapsed');
            if (saved === '1') body.classList.add('sidebar-collapsed');
        } catch (e) { }

        function updateAria() {
            const expanded = !body.classList.contains('sidebar-collapsed');
            if (btn) btn.setAttribute('aria-expanded', expanded ? 'true' : 'false');
        }

        btn?.addEventListener('click', function () {
            body.classList.toggle('sidebar-collapsed');
            updateAria();
            try {
                localStorage.setItem('sidebar-collapsed', body.classList.contains('sidebar-collapsed') ? '1' : '0');
            } catch (e) { }
        });

        updateAria();

        // Delete confirmation for links with data-delete
        document.querySelectorAll('a.btn-delete, a[data-delete], button[data-delete]').forEach(el => {
            el.addEventListener('click', function (e) {
                e.preventDefault();
                const href = this.getAttribute('href') || this.dataset.href;
                const name = this.dataset.name || 'bản ghi này';
                if (!href) return;
                Swal.fire({
                    title: 'Bạn có chắc không?',
                    html: `Bạn đang xóa người dùng: <strong>"${name}"</strong>`,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#f56565',
                    cancelButtonColor: '#6b7280',
                    confirmButtonText: '<svg style="width:16px;height:16px;display:inline-block;margin-right:6px" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>Có, xóa nó',
                    cancelButtonText: '<svg style="width:16px;height:16px;display:inline-block;margin-right:6px" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>Hủy',
                    reverseButtons: true,
                    customClass: {
                        confirmButton: 'swal2-confirm',
                        cancelButton: 'swal2-cancel'
                    }
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Show loading
                        Swal.fire({
                            title: 'Đang xóa...',
                            html: 'Vui lòng đợi',
                            allowOutsideClick: false,
                            didOpen: () => {
                                Swal.showLoading();
                            }
                        });
                        window.location.href = href;
                    }
                });
            });
        });

        // Toast: show if URL has ?message=...
        try {
            const params = new URLSearchParams(window.location.search);
            const msg = params.get('message');
            const type = params.get('type') || 'success';
            if (msg) {
                Swal.fire({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 4000,
                    timerProgressBar: true,
                    icon: type === 'success' ? 'success' : type === 'error' ? 'error' : 'info',
                    title: msg,
                    background: '#fff',
                    customClass: {
                        popup: 'colored-toast'
                    }
                });
                const cleanUrl = window.location.pathname + window.location.hash;
                window.history.replaceState({}, document.title, cleanUrl);
            }
        } catch (e) {
            // ignore
        }

        // Client-side search with "no results" row
        const searchInput = document.getElementById('top-search');
        if (searchInput) {
            searchInput.addEventListener('input', function (e) {
                const q = e.target.value.trim().toLowerCase();
                document.querySelectorAll('.table-users').forEach(table => {
                    const tbody = table.tBodies[0];
                    if (!tbody) return;
                    const rows = Array.from(tbody.querySelectorAll('tr'));
                    let visibleCount = 0;
                    rows.forEach(row => {
                        if (row.classList.contains('no-results-row')) return;
                        const text = row.textContent.toLowerCase();
                        const match = q === '' || text.includes(q);
                        row.style.display = match ? '' : 'none';
                        if (match) visibleCount++;
                    });

                    const existing = tbody.querySelector('tr.no-results-row');
                    if (existing) existing.remove();

                    const dataRowsCount = rows.filter(r => !r.classList.contains('no-results-row')).length;
                    if (visibleCount === 0 && dataRowsCount > 0 && q !== '') {
                        const colCount = table.querySelectorAll('thead th').length || 1;
                        const noRow = document.createElement('tr');
                        noRow.className = 'no-results-row';
                        const td = document.createElement('td');
                        td.setAttribute('colspan', colCount);
                        td.innerHTML = `
                            <div class="no-results-content">
                                <div class="no-results-icon">
                                    <svg viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="no-results-title">Không tìm thấy kết quả</h3>
                                    <p class="no-results-text">
                                        Không có người dùng nào khớp với từ khóa 
                                        <span class="search-term">"${escapeHtml(q)}"</span>
                                    </p>
                                    <p class="no-results-text" style="font-size:13px;margin-top:8px">
                                        <svg style="width:14px;height:14px;display:inline-block;vertical-align:middle;margin-right:4px" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                                        </svg>
                                        Thử tìm kiếm với từ khóa khác hoặc <a href="javascript:void(0)" onclick="document.getElementById('top-search').value='';document.getElementById('top-search').dispatchEvent(new Event('input'))" style="color:var(--primary);text-decoration:underline">xóa bộ lọc</a>
                                    </p>
                                </div>
                            </div>
                        `;
                        noRow.appendChild(td);
                        tbody.appendChild(noRow);
                    }
                });
            });
            
            // Add clear button to search
            const searchContainer = searchInput.parentElement;
            const clearBtn = document.createElement('button');
            clearBtn.type = 'button';
            clearBtn.className = 'search-clear-btn';
            clearBtn.innerHTML = '<svg style="width:16px;height:16px" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>';
            clearBtn.style.cssText = 'position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;color:rgba(255,255,255,0.7);cursor:pointer;padding:4px;display:none;transition:all 0.3s';
            clearBtn.onclick = function() {
                searchInput.value = '';
                searchInput.dispatchEvent(new Event('input'));
                searchInput.focus();
            };
            searchContainer.appendChild(clearBtn);
            
            searchInput.addEventListener('input', function() {
                clearBtn.style.display = this.value ? 'block' : 'none';
            });
        }
        
        // Helper function to escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Hover effects for footer links
        document.querySelectorAll('.admin-footer a').forEach(link => {
            link.addEventListener('mouseenter', function() {
                this.style.color = 'var(--primary)';
            });
            link.addEventListener('mouseleave', function() {
                this.style.color = 'var(--muted)';
            });
        });
    })();
</script>

<style>
    .table-users tr.no-results td {
        background: transparent;
    }
    
    .colored-toast.swal2-icon-success {
        background-color: #ecfdf5 !important;
    }
    
    .colored-toast.swal2-icon-error {
        background-color: #fef2f2 !important;
    }
    
    .colored-toast.swal2-icon-info {
        background-color: #eff6ff !important;
    }
</style>

</body>
</html>